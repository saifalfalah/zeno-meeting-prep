openapi: 3.1.0
info:
  title: Ad-Hoc Research API
  description: API endpoint for creating ad-hoc research requests with website field support
  version: 2.0.0
  contact:
    name: Zeno Meeting Prep API

servers:
  - url: http://localhost:3000/api
    description: Local development
  - url: https://app.zenomeetingprep.com/api
    description: Production

paths:
  /adhoc:
    post:
      summary: Create ad-hoc research request
      description: |
        Creates a new ad-hoc research request for a prospect/company.
        Requires at least one identifying field (prospectName, companyName, email, or website).

        **Changes in v2.0.0**:
        - Added optional `website` field
        - Website is prioritized over email domain when both are provided
        - Website-only submissions are now valid
      operationId: createAdHocResearch
      tags:
        - Research
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAdHocRequest'
            examples:
              withWebsite:
                summary: With website field (v2.0.0)
                value:
                  prospectName: "Jane Doe"
                  companyName: "Acme Corp"
                  email: "jane@acme.com"
                  website: "https://acme.com"
                  campaignId: "550e8400-e29b-41d4-a716-446655440000"
              websiteOnly:
                summary: Website only (v2.0.0)
                value:
                  website: "https://example.com"
                  campaignId: "550e8400-e29b-41d4-a716-446655440000"
              legacy:
                summary: Legacy format (v1.0.0 compatible)
                value:
                  prospectName: "John Smith"
                  email: "john@company.com"
                  campaignId: "550e8400-e29b-41d4-a716-446655440000"
      responses:
        '201':
          description: Ad-hoc research request created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdHocResearchResponse'
              example:
                id: "660e8400-e29b-41d4-a716-446655440000"
                userId: "550e8400-e29b-41d4-a716-446655440001"
                campaignId: "550e8400-e29b-41d4-a716-446655440002"
                prospectName: "Jane Doe"
                companyName: "Acme Corp"
                email: "jane@acme.com"
                website: "https://acme.com"
                status: "pending"
                researchBriefId: null
                failureReason: null
                createdAt: "2025-12-10T10:30:00.000Z"
                updatedAt: "2025-12-10T10:30:00.000Z"
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                noIdentifyingField:
                  summary: No identifying field provided
                  value:
                    error: "Validation error"
                    message: "At least one of prospectName, companyName, email, or website is required"
                    code: "VALIDATION_ERROR"
                invalidEmail:
                  summary: Invalid email format
                  value:
                    error: "Validation error"
                    message: "Invalid email format"
                    code: "VALIDATION_ERROR"
                invalidWebsite:
                  summary: Invalid website URL
                  value:
                    error: "Validation error"
                    message: "Website must be a valid URL (e.g., https://example.com)"
                    code: "VALIDATION_ERROR"
                invalidCampaign:
                  summary: Invalid campaign ID
                  value:
                    error: "Validation error"
                    message: "Campaign ID is required"
                    code: "VALIDATION_ERROR"
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Unauthorized"
                message: "Authentication required"
                code: "UNAUTHORIZED"
        '404':
          description: Campaign not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Not Found"
                message: "Campaign not found"
                code: "CAMPAIGN_NOT_FOUND"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Internal Server Error"
                message: "Failed to create research request"
                code: "INTERNAL_ERROR"
      security:
        - sessionAuth: []

components:
  schemas:
    CreateAdHocRequest:
      type: object
      required:
        - campaignId
      properties:
        prospectName:
          type: string
          maxLength: 255
          description: Name of the prospect (optional if other fields provided)
          example: "Jane Doe"
        companyName:
          type: string
          maxLength: 255
          description: Name of the company (optional if other fields provided)
          example: "Acme Corp"
        email:
          type: string
          format: email
          maxLength: 255
          description: Email address of the prospect (optional if other fields provided)
          example: "jane@acme.com"
        website:
          type: string
          format: uri
          maxLength: 500
          description: |
            Company website URL (optional, added in v2.0.0).
            Accepts formats: https://example.com, http://example.com, example.com
            Prioritized over email domain when both are provided.
          example: "https://acme.com"
        campaignId:
          type: string
          format: uuid
          description: UUID of the campaign to associate research with
          example: "550e8400-e29b-41d4-a716-446655440000"
      oneOf:
        - required: [prospectName]
        - required: [companyName]
        - required: [email]
        - required: [website]

    AdHocResearchResponse:
      type: object
      required:
        - id
        - userId
        - campaignId
        - status
        - createdAt
        - updatedAt
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the research request
        userId:
          type: string
          format: uuid
          description: UUID of the user who created the request
        campaignId:
          type: string
          format: uuid
          description: UUID of the associated campaign
        prospectName:
          type: string
          nullable: true
          description: Name of the prospect
        companyName:
          type: string
          nullable: true
          description: Name of the company
        email:
          type: string
          nullable: true
          description: Email address of the prospect
        website:
          type: string
          nullable: true
          description: Company website URL (added in v2.0.0)
        status:
          type: string
          enum: [pending, generating, ready, failed]
          description: Current status of the research request
        researchBriefId:
          type: string
          format: uuid
          nullable: true
          description: UUID of the generated research brief (null until ready)
        failureReason:
          type: string
          nullable: true
          description: Explanation if status is 'failed'
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the request was created
        updatedAt:
          type: string
          format: date-time
          description: Timestamp when the request was last updated

    ErrorResponse:
      type: object
      required:
        - error
        - message
        - code
      properties:
        error:
          type: string
          description: High-level error category
        message:
          type: string
          description: Human-readable error message
        code:
          type: string
          description: Machine-readable error code
        details:
          type: object
          description: Additional error context (optional)
          additionalProperties: true

  securitySchemes:
    sessionAuth:
      type: apiKey
      in: cookie
      name: session
      description: Session-based authentication via HTTP-only cookie

tags:
  - name: Research
    description: Ad-hoc research request operations
